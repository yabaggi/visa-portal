<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --primary: #1a56db; --primary-dark: #1e40af; --primary-light: #dbeafe;
      --success: #059669; --success-light: #d1fae5;
      --warning: #d97706; --warning-light: #fef3c7;
      --danger: #dc2626; --danger-light: #fee2e2;
      --purple: #7c3aed; --purple-light: #ede9fe;
      --gray-50: #f9fafb; --gray-100: #f3f4f6; --gray-200: #e5e7eb;
      --gray-300: #d1d5db; --gray-500: #6b7280; --gray-700: #374151; --gray-900: #111827;
      --radius: 12px;
      --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.07), 0 2px 4px rgba(0,0,0,0.06);
    }

    html, body {
      height: 100%;
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y pan-x;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--gray-50); color: var(--gray-900); line-height: 1.5;
    }

    html[dir="rtl"] body { font-family: 'Segoe UI', Tahoma, 'Cairo', 'Noto Sans Arabic', sans-serif; }

    .header {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      color: white; padding: 16px 16px 14px; text-align: center;
      box-shadow: var(--shadow-md);
    }

    .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
    .header h1 { font-size: 20px; font-weight: 700; flex: 1; }
    .header p { font-size: 13px; opacity: 0.8; }

    .lang-toggle {
      background: rgba(255,255,255,0.2); border: 1.5px solid rgba(255,255,255,0.4);
      color: white; padding: 6px 14px; border-radius: 20px; font-size: 13px;
      font-weight: 600; cursor: pointer; white-space: nowrap; touch-action: manipulation;
    }

    .nav-tabs {
      display: flex; background: white; border-bottom: 1px solid var(--gray-200);
      box-shadow: var(--shadow);
    }

    .nav-tab {
      flex: 1; padding: 12px 4px; text-align: center; font-size: 12px; font-weight: 600;
      color: var(--gray-500); border: none; background: none; cursor: pointer;
      border-bottom: 3px solid transparent; touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
    }

    .nav-tab.active { color: var(--primary); border-bottom-color: var(--primary); background: var(--primary-light); }
    .nav-tab svg { display: block; margin: 0 auto 3px; pointer-events: none; }

    .container { max-width: 800px; margin: 0 auto; padding: 16px; }
    .section { display: none; }
    .section.active { display: block; }

    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }

    .stat-card {
      background: white; border-radius: var(--radius); padding: 18px 16px;
      box-shadow: var(--shadow); border: 1px solid var(--gray-200); border-inline-start: 4px solid;
    }

    .stat-card.total { border-inline-start-color: var(--primary); }
    .stat-card.pending { border-inline-start-color: var(--warning); }
    .stat-card.review { border-inline-start-color: var(--purple); }
    .stat-card.approved { border-inline-start-color: var(--success); }
    .stat-card.rejected { border-inline-start-color: var(--danger); }

    .stat-card .stat-number { font-size: 28px; font-weight: 800; line-height: 1; }
    .stat-card.total .stat-number { color: var(--primary); }
    .stat-card.pending .stat-number { color: var(--warning); }
    .stat-card.review .stat-number { color: var(--purple); }
    .stat-card.approved .stat-number { color: var(--success); }
    .stat-card.rejected .stat-number { color: var(--danger); }
    .stat-card .stat-label { font-size: 12px; color: var(--gray-500); font-weight: 600; text-transform: uppercase; margin-top: 4px; }

    .filter-bar { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 12px; margin-bottom: 16px; -webkit-overflow-scrolling: touch; }

    .filter-btn {
      padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600;
      border: 1.5px solid var(--gray-300); background: white; color: var(--gray-700);
      cursor: pointer; white-space: nowrap; touch-action: manipulation;
    }

    .filter-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

    .app-card {
      background: white; border-radius: var(--radius); padding: 16px; margin-bottom: 12px;
      box-shadow: var(--shadow); border: 1px solid var(--gray-200); cursor: pointer;
      touch-action: manipulation;
    }

    .app-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
    .app-card-name { font-size: 16px; font-weight: 700; }
    .app-card-id { font-size: 12px; color: var(--gray-500); font-family: monospace; }
    .app-card-meta { display: flex; flex-wrap: wrap; gap: 12px; font-size: 13px; color: var(--gray-500); }

    .status-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .status-Pending { background: var(--warning-light); color: #92400e; }
    .status-Under-Review { background: var(--purple-light); color: #5b21b6; }
    .status-Approved { background: var(--success-light); color: #065f46; }
    .status-Rejected { background: var(--danger-light); color: #991b1b; }

    .detail-overlay {
      display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: var(--gray-50); z-index: 200;
      overflow-y: auto; -webkit-overflow-scrolling: touch; touch-action: pan-y pan-x;
    }

    .detail-overlay.show { display: block; }

    .detail-header {
      background: white; padding: 16px; display: flex; align-items: center; gap: 12px;
      border-bottom: 1px solid var(--gray-200);
    }

    .detail-header .back-btn {
      background: none; border: none; font-size: 24px; cursor: pointer; color: var(--gray-700);
      padding: 8px; touch-action: manipulation;
    }

    .detail-header h2 { font-size: 18px; flex: 1; }
    .detail-body { max-width: 700px; margin: 0 auto; padding: 16px; padding-bottom: 60px; }

    .detail-card {
      background: white; border-radius: var(--radius); padding: 20px; margin-bottom: 16px;
      box-shadow: var(--shadow); border: 1px solid var(--gray-200);
    }

    .detail-card h3 {
      font-size: 15px; font-weight: 700; margin-bottom: 14px; padding-bottom: 10px;
      border-bottom: 2px solid var(--gray-100); display: flex; align-items: center; gap: 8px;
    }

    .detail-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid var(--gray-100); font-size: 14px; }
    .detail-row:last-child { border-bottom: none; }
    .detail-label { color: var(--gray-500); font-weight: 500; flex: 0 0 40%; }
    .detail-value { font-weight: 600; text-align: end; flex: 1; word-break: break-word; }

    .action-card {
      background: white; border-radius: var(--radius); padding: 20px; margin-bottom: 16px;
      box-shadow: var(--shadow); border: 1px solid var(--gray-200);
    }

    .action-card h3 { font-size: 15px; font-weight: 700; margin-bottom: 16px; }

    .action-card select, .action-card textarea {
      width: 100%; padding: 12px; border: 1.5px solid var(--gray-300); border-radius: 8px;
      font-size: 14px; margin-bottom: 12px; -webkit-appearance: none; touch-action: manipulation;
    }

    html[dir="rtl"] .action-card select, html[dir="rtl"] .action-card textarea { text-align: right; }

    .action-card select:focus, .action-card textarea:focus {
      outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(26,86,219,0.15);
    }

    .btn {
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
      padding: 12px 20px; border: none; border-radius: 8px; font-size: 14px;
      font-weight: 600; cursor: pointer; width: 100%;
      touch-action: manipulation; -webkit-tap-highlight-color: transparent;
    }

    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { background: var(--primary-dark); }
    .btn-primary:disabled { background: var(--gray-300); cursor: not-allowed; }
    .btn-delete { background: white; color: var(--danger); border: 1.5px solid var(--danger); margin-top: 12px; }

    .empty-state { text-align: center; padding: 48px 16px; color: var(--gray-500); }
    .empty-state .empty-icon { font-size: 48px; margin-bottom: 12px; }

    .photo-preview { text-align: center; margin: 12px 0; }
    .photo-preview img { max-width: 150px; max-height: 200px; border-radius: 8px; box-shadow: var(--shadow); }

    .spinner { display: inline-block; width: 18px; height: 18px; border: 3px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: white; animation: spin 0.8s ease infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .loading-state { text-align: center; padding: 32px; color: var(--gray-500); }

    .search-bar { margin-bottom: 16px; }
    .search-bar input {
      width: 100%; padding: 12px 16px 12px 40px; border: 1.5px solid var(--gray-300);
      border-radius: 8px; font-size: 14px; touch-action: manipulation;
      background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'/%3E%3C/svg%3E") 14px center no-repeat;
    }

    html[dir="rtl"] .search-bar input { padding: 12px 40px 12px 16px; background-position: calc(100% - 14px) center; }
    .search-bar input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(26,86,219,0.15); }

    .alert { padding: 14px 16px; border-radius: 8px; font-size: 14px; margin-bottom: 16px; }
    .alert-success { background: var(--success-light); color: #065f46; border: 1px solid #a7f3d0; }
    .alert-error { background: var(--danger-light); color: #991b1b; border: 1px solid #fecaca; }

    .stat-card-full { grid-column: span 2; }

    .settings-card {
      background: white; border-radius: var(--radius); padding: 0; margin-bottom: 16px;
      box-shadow: var(--shadow); border: 1px solid var(--gray-200); overflow: hidden;
    }

    .settings-card-header {
      background: var(--gray-50); padding: 14px 16px; font-weight: 700; font-size: 14px;
      border-bottom: 1px solid var(--gray-200); display: flex; align-items: center; gap: 8px;
    }

    .field-row {
      display: flex; align-items: center; padding: 12px 16px;
      border-bottom: 1px solid var(--gray-100); gap: 10px;
    }

    .field-row:last-child { border-bottom: none; }
    .field-row .field-name { flex: 1; font-size: 14px; font-weight: 500; min-width: 0; }

    .toggle-group { display: flex; gap: 12px; align-items: center; flex-shrink: 0; }
    .toggle-item { display: flex; align-items: center; gap: 5px; font-size: 11px; color: var(--gray-500); }

    .toggle-switch {
      position: relative; width: 40px; height: 22px; background: var(--gray-300);
      border-radius: 11px; cursor: pointer; flex-shrink: 0;
      touch-action: manipulation; -webkit-tap-highlight-color: transparent;
    }

    .toggle-switch.on { background: var(--primary); }
    .toggle-switch.on-green { background: var(--success); }

    .toggle-switch::after {
      content: ''; position: absolute; width: 18px; height: 18px;
      background: white; border-radius: 50%; top: 2px; left: 2px;
      transition: transform 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    .toggle-switch.on::after, .toggle-switch.on-green::after { transform: translateX(18px); }
    html[dir="rtl"] .toggle-switch::after { left: auto; right: 2px; }
    html[dir="rtl"] .toggle-switch.on::after, html[dir="rtl"] .toggle-switch.on-green::after { transform: translateX(-18px); }

    .settings-save-bar {
      padding: 16px 0; margin-top: 8px;
    }
  </style>
</head>
<body>

  <div class="header">
    <div class="header-top">
      <div style="width:60px;"></div>
      <h1 data-i18n="adminTitle">ğŸ›‚ Visa Admin Portal</h1>
      <button class="lang-toggle" onclick="toggleLang()" id="langBtn">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
    </div>
    <p data-i18n="adminSub">Application Management System</p>
  </div>




<!-- HOME BUTTON -->
<div style="padding:10px 16px;background:#0f172a;display:flex;align-items:center;gap:10px;border-bottom:1px solid rgba(255,255,255,0.08);">
  <button onclick="goToLanding()" style="display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);color:rgba(255,255,255,0.8);padding:8px 16px;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;transition:all 0.3s;">
    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
    Home
  </button>
  <span style="color:rgba(255,255,255,0.4);font-size:13px;">Admin Portal</span>
</div>


  <div class="nav-tabs">
    <button class="nav-tab active" onclick="showAdminSection('dashboard')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
      <span data-i18n="navDashboard">Dashboard</span>
    </button>
    <button class="nav-tab" onclick="showAdminSection('applications')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      <span data-i18n="navApplications">Applications</span>
    </button>
    <button class="nav-tab" onclick="showAdminSection('settings')">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
      <span data-i18n="navSettings">Settings</span>
    </button>
  </div>

  <!-- DASHBOARD -->
  <div id="admin-dashboard" class="section active">
    <div class="container">
      <div class="stats-grid">
        <div class="stat-card total"><div class="stat-number" id="stat-total">-</div><div class="stat-label" data-i18n="statTotal">Total</div></div>
        <div class="stat-card pending"><div class="stat-number" id="stat-pending">-</div><div class="stat-label" data-i18n="statPending">Pending</div></div>
        <div class="stat-card review"><div class="stat-number" id="stat-review">-</div><div class="stat-label" data-i18n="statReview">Under Review</div></div>
        <div class="stat-card approved"><div class="stat-number" id="stat-approved">-</div><div class="stat-label" data-i18n="statApproved">Approved</div></div>
        <div class="stat-card rejected stat-card-full"><div class="stat-number" id="stat-rejected">-</div><div class="stat-label" data-i18n="statRejected">Rejected</div></div>
      </div>
      <h3 style="font-size:16px;font-weight:700;margin-bottom:12px;" data-i18n="recentApps">ğŸ“‹ Recent Applications</h3>
      <div id="recentApps"><div class="loading-state">Loading...</div></div>
    </div>
  </div>

  <!-- APPLICATIONS -->
  <div id="admin-applications" class="section">
    <div class="container">
      <div class="search-bar"><input type="text" id="searchInput" data-placeholder-i18n="searchPlaceholder" placeholder="Search by name, passport, or ID..." oninput="filterLocalApps()"></div>
      <div class="filter-bar">
        <button class="filter-btn active" onclick="applyFilter('All',this)" data-i18n="filterAll">All</button>
        <button class="filter-btn" onclick="applyFilter('Pending',this)" data-i18n="filterPending">Pending</button>
        <button class="filter-btn" onclick="applyFilter('Under Review',this)" data-i18n="filterReview">Under Review</button>
        <button class="filter-btn" onclick="applyFilter('Approved',this)" data-i18n="filterApproved">Approved</button>
        <button class="filter-btn" onclick="applyFilter('Rejected',this)" data-i18n="filterRejected">Rejected</button>
      </div>
      <div id="appsList"><div class="loading-state">Loading applications...</div></div>
    </div>
  </div>
  
  
  
  
  
    <!-- SETTINGS -->
  <div id="admin-settings" class="section">
    <div class="container">
      <div style="margin-bottom:16px;">
        <h3 style="font-size:18px;font-weight:700;margin-bottom:4px;" data-i18n="settingsTitle">âš™ï¸ Form Field Settings</h3>
        <p style="font-size:13px;color:var(--gray-500);" data-i18n="settingsDesc">Toggle fields on/off and set which are required</p>
      </div>
      <div id="settingsAlert"></div>
      <div id="settingsContainer"><div class="loading-state">Loading...</div></div>
      <div class="settings-save-bar">
        <button class="btn btn-primary" id="saveSettingsBtn" onclick="saveSettings()">
          <span data-i18n="btnSaveSettings">ğŸ’¾ Save Settings</span>
        </button>
      </div>

      <!-- LANDING PAGE SETTINGS -->
      <div style="background:#fff;border-radius:12px;border:1px solid #e2e8f0;padding:28px;margin-top:20px;">
        <h3 style="font-size:18px;font-weight:700;color:#1e293b;margin-bottom:6px;">ğŸ  Landing Page Settings</h3>
        <p style="font-size:13px;color:#64748b;margin-bottom:20px;">Customize the landing page that visitors see first</p>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;" id="settingsGrid">

          <div style="grid-column:span 2;">
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Organization Name</label>
            <input type="text" id="set_orgName" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="Republic of Veridian">
          </div>

          <div style="grid-column:span 2;">
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Tagline</label>
            <input type="text" id="set_tagline" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="Electronic Visa Application System">
          </div>

          <div style="grid-column:span 2;">
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Hero Title</label>
            <input type="text" id="set_heroTitle" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="Welcome to the Official Visa Portal">
          </div>

          <div style="grid-column:span 2;">
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Hero Subtitle</label>
            <input type="text" id="set_heroSubtitle" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="Fast, secure, and transparent visa processing">
          </div>

          <div>
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Hero Background Image URL</label>
            <input type="url" id="set_heroImageUrl" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="https://...">
          </div>

          <div>
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Logo URL</label>
            <input type="url" id="set_logoUrl" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="https://...">
          </div>

          <div>
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Admin Password</label>
            <input type="text" id="set_adminPassword" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="admin123">
          </div>

          <div>
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Announcement <span style="color:#94a3b8;font-weight:400;">(empty = hidden)</span></label>
            <input type="text" id="set_announcementText" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="e.g. New visa types available!">
          </div>

          <div>
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Primary Color</label>
            <div style="display:flex;gap:8px;align-items:center;">
              <input type="color" id="set_primaryColor" value="#1e40af" style="width:48px;height:38px;border:1px solid #e2e8f0;border-radius:8px;cursor:pointer;padding:2px;">
              <input type="text" id="set_primaryColorText" style="flex:1;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;font-family:monospace;outline:none;" placeholder="#1e40af">
            </div>
          </div>

          <div>
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Accent Color</label>
            <div style="display:flex;gap:8px;align-items:center;">
              <input type="color" id="set_accentColor" value="#3b82f6" style="width:48px;height:38px;border:1px solid #e2e8f0;border-radius:8px;cursor:pointer;padding:2px;">
              <input type="text" id="set_accentColorText" style="flex:1;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;font-family:monospace;outline:none;" placeholder="#3b82f6">
            </div>
          </div>

          <div>
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Apply Button Text</label>
            <input type="text" id="set_portalButtonText" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="Apply for Visa">
          </div>

          <div>
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Admin Button Text</label>
            <input type="text" id="set_adminButtonText" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="Admin Portal">
          </div>

          <div style="grid-column:span 2;">
            <label style="display:block;font-size:13px;font-weight:600;color:#475569;margin-bottom:6px;">Footer Text</label>
            <input type="text" id="set_footerText" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:8px;font-size:14px;outline:none;" placeholder="Â© 2026 Republic of Veridian â€” Immigration & Border Control">
          </div>

        </div>

        <div style="display:flex;gap:12px;margin-top:24px;align-items:center;">
          <button onclick="saveLandingSettings()" style="padding:12px 28px;background:linear-gradient(135deg,#1e40af,#3b82f6);color:#fff;border:none;border-radius:10px;font-size:15px;font-weight:600;cursor:pointer;transition:all 0.3s;">
            ğŸ’¾ Save Landing Settings
          </button>
          <span id="settingsSaveStatus" style="color:#059669;font-size:14px;font-weight:500;"></span>
        </div>
      </div>
      <!-- END LANDING PAGE SETTINGS -->

    </div>
  </div>

  <!-- DETAIL -->
  <div class="detail-overlay" id="detailOverlay">
    <div class="detail-header">
      <button class="back-btn" onclick="closeDetail()">â†</button>
      <h2 id="detailTitle">Application Details</h2>
    </div>
    <div class="detail-body" id="detailBody"></div>
  </div>

  <script>
    var currentLang="en";

    var FIELD_LABELS={
      en:{surname:"Surname",firstName:"First Name",dateOfBirth:"Date of Birth",placeOfBirth:"Place of Birth",nationality:"Nationality",gender:"Gender",maritalStatus:"Marital Status",passportNumber:"Passport Number",issuingCountry:"Issuing Country",dateOfIssue:"Date of Issue",expirationDate:"Expiration Date",homeAddress:"Home Address",email:"Email",telephone:"Telephone",purposeOfTravel:"Purpose of Travel",arrivalDate:"Arrival Date",departureDate:"Departure Date",destination:"Destination",parentSpouseName:"Parent/Spouse",sponsorContact:"Sponsor Contact",hotelInfo:"Hotel/Accommodation",photo:"Photograph"},
      ar:{surname:"Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©",firstName:"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„",dateOfBirth:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯",placeOfBirth:"Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯",nationality:"Ø§Ù„Ø¬Ù†Ø³ÙŠØ©",gender:"Ø§Ù„Ø¬Ù†Ø³",maritalStatus:"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",passportNumber:"Ø±Ù‚Ù… Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±",issuingCountry:"Ø¨Ù„Ø¯ Ø§Ù„Ø¥ØµØ¯Ø§Ø±",dateOfIssue:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±",expirationDate:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡",homeAddress:"Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³ÙƒÙ†",email:"Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",telephone:"Ø§Ù„Ù‡Ø§ØªÙ",purposeOfTravel:"ØºØ±Ø¶ Ø§Ù„Ø³ÙØ±",arrivalDate:"ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆØµÙˆÙ„",departureDate:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©",destination:"Ø§Ù„ÙˆØ¬Ù‡Ø©",parentSpouseName:"Ø§Ù„ÙˆØ§Ù„Ø¯/Ø§Ù„Ø²ÙˆØ¬(Ø©)",sponsorContact:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙÙŠÙ„",hotelInfo:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙÙ†Ø¯Ù‚",photo:"Ø§Ù„ØµÙˆØ±Ø©"}
    };

    var FIELD_GROUPS={
      en:{personal:"ğŸ‘¤ Personal Information",passport:"ğŸ“˜ Passport Details",contact:"ğŸ“ Contact Information",travel:"ğŸ—ºï¸ Purpose & Itinerary",family:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Family / Reference & Photo"},
      ar:{personal:"ğŸ‘¤ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©",passport:"ğŸ“˜ ØªÙØ§ØµÙŠÙ„ Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±",contact:"ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„",travel:"ğŸ—ºï¸ Ø§Ù„ØºØ±Ø¶ ÙˆØ®Ø· Ø§Ù„Ø³ÙŠØ±",family:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© ÙˆØ§Ù„ØµÙˆØ±Ø©"}
    };

    var FIELD_TO_GROUP={surname:"personal",firstName:"personal",dateOfBirth:"personal",placeOfBirth:"personal",nationality:"personal",gender:"personal",maritalStatus:"personal",passportNumber:"passport",issuingCountry:"passport",dateOfIssue:"passport",expirationDate:"passport",homeAddress:"contact",email:"contact",telephone:"contact",purposeOfTravel:"travel",arrivalDate:"travel",departureDate:"travel",destination:"travel",parentSpouseName:"family",sponsorContact:"family",hotelInfo:"family",photo:"family"};

    var translations={
      en:{adminTitle:"ğŸ›‚ Visa Admin Portal",adminSub:"Application Management System",navDashboard:"Dashboard",navApplications:"Applications",navSettings:"Settings",statTotal:"Total",statPending:"Pending",statReview:"Under Review",statApproved:"Approved",statRejected:"Rejected",recentApps:"ğŸ“‹ Recent Applications",loading:"Loading...",loadingApps:"Loading applications...",searchPlaceholder:"Search by name, passport, or ID...",filterAll:"All",filterPending:"Pending",filterReview:"Under Review",filterApproved:"Approved",filterRejected:"Rejected",detailTitle:"Application Details",noApps:"No applications found",secPersonal:"ğŸ‘¤ Personal Information",secPassport:"ğŸ“˜ Passport Details",secContact:"ğŸ“ Contact Information",secTravel:"ğŸ—ºï¸ Purpose & Itinerary",secFamily:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Family / Reference",secPhoto:"ğŸ“· Photograph",secActions:"âš¡ Update Status",lblAppId:"Application ID",lblSubmitted:"Submitted",lblSurname:"Surname",lblFirstName:"First Name",lblDob:"Date of Birth",lblPob:"Place of Birth",lblNationality:"Nationality",lblGender:"Gender",lblMarital:"Marital Status",lblPassportNum:"Passport Number",lblIssuing:"Issuing Country",lblIssueDate:"Date of Issue",lblExpDate:"Expiration Date",lblAddress:"Home Address",lblEmail:"Email",lblPhone:"Telephone",lblPurpose:"Purpose",lblArrival:"Arrival Date",lblDeparture:"Departure Date",lblDestination:"Destination",lblParent:"Parent/Spouse",lblSponsor:"Sponsor Contact",lblHotel:"Hotel Info",optPending:"Pending",optReview:"Under Review",optApproved:"Approved",optRejected:"Rejected",btnUpdate:"Update Status",btnDelete:"ğŸ—‘ï¸ Delete Application",btnUpdating:"Updating...",alertUpdated:"âœ… Status updated successfully!",alertConfirmDelete:"Are you sure you want to permanently delete this application?",notesPlaceholder:"Add admin notes...",settingsTitle:"âš™ï¸ Form Field Settings",settingsDesc:"Toggle fields on/off and set which are required",btnSaveSettings:"ğŸ’¾ Save Settings",settingsSaving:"Saving...",settingsSaved:"âœ… Settings saved! Changes will appear in the Visa Portal.",settingsError:"Error saving: ",toggleVisible:"Show",toggleRequired:"Required"},
      ar:{adminTitle:"ğŸ›‚ Ø¨ÙˆØ§Ø¨Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ£Ø´ÙŠØ±Ø§Øª",adminSub:"Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª",navDashboard:"Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",navApplications:"Ø§Ù„Ø·Ù„Ø¨Ø§Øª",navSettings:"Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",statTotal:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",statPending:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",statReview:"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",statApproved:"Ù…Ù‚Ø¨ÙˆÙ„",statRejected:"Ù…Ø±ÙÙˆØ¶",recentApps:"ğŸ“‹ Ø£Ø­Ø¯Ø« Ø§Ù„Ø·Ù„Ø¨Ø§Øª",loading:"Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...",loadingApps:"Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...",searchPlaceholder:"Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø² Ø£Ùˆ Ø§Ù„Ø·Ù„Ø¨...",filterAll:"Ø§Ù„ÙƒÙ„",filterPending:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",filterReview:"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",filterApproved:"Ù…Ù‚Ø¨ÙˆÙ„",filterRejected:"Ù…Ø±ÙÙˆØ¶",detailTitle:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨",noApps:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª",secPersonal:"ğŸ‘¤ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©",secPassport:"ğŸ“˜ ØªÙØ§ØµÙŠÙ„ Ø¬ÙˆØ§Ø² Ø§Ù„Ø³ÙØ±",secContact:"ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„",secTravel:"ğŸ—ºï¸ Ø§Ù„ØºØ±Ø¶ ÙˆØ®Ø· Ø§Ù„Ø³ÙŠØ±",secFamily:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©",secPhoto:"ğŸ“· Ø§Ù„ØµÙˆØ±Ø©",secActions:"âš¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©",lblAppId:"Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨",lblSubmitted:"ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…",lblSurname:"Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©",lblFirstName:"Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„",lblDob:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯",lblPob:"Ù…ÙƒØ§Ù† Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯",lblNationality:"Ø§Ù„Ø¬Ù†Ø³ÙŠØ©",lblGender:"Ø§Ù„Ø¬Ù†Ø³",lblMarital:"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©",lblPassportNum:"Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ø²",lblIssuing:"Ø¨Ù„Ø¯ Ø§Ù„Ø¥ØµØ¯Ø§Ø±",lblIssueDate:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±",lblExpDate:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡",lblAddress:"Ø§Ù„Ø¹Ù†ÙˆØ§Ù†",lblEmail:"Ø§Ù„Ø¨Ø±ÙŠØ¯",lblPhone:"Ø§Ù„Ù‡Ø§ØªÙ",lblPurpose:"Ø§Ù„ØºØ±Ø¶",lblArrival:"ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆØµÙˆÙ„",lblDeparture:"ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©",lblDestination:"Ø§Ù„ÙˆØ¬Ù‡Ø©",lblParent:"Ø§Ù„ÙˆØ§Ù„Ø¯/Ø§Ù„Ø²ÙˆØ¬(Ø©)",lblSponsor:"Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒÙÙŠÙ„",lblHotel:"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙÙ†Ø¯Ù‚",optPending:"Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±",optReview:"Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©",optApproved:"Ù…Ù‚Ø¨ÙˆÙ„",optRejected:"Ù…Ø±ÙÙˆØ¶",btnUpdate:"ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©",btnDelete:"ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨",btnUpdating:"Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ø¯ÙŠØ«...",alertUpdated:"âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!",alertConfirmDelete:"Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ",notesPlaceholder:"Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª...",settingsTitle:"âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬",settingsDesc:"ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ©",btnSaveSettings:"ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",settingsSaving:"Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸...",settingsSaved:"âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸! Ø³ØªØ¸Ù‡Ø± Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªØ£Ø´ÙŠØ±Ø©.",settingsError:"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸: ",toggleVisible:"Ø¥Ø¸Ù‡Ø§Ø±",toggleRequired:"Ø¥Ù„Ø²Ø§Ù…ÙŠ"}
    };

    function t(k){return(translations[currentLang]&&translations[currentLang][k])||translations.en[k]||k;}

    function applyTranslations(){
      document.querySelectorAll('[data-i18n]').forEach(function(el){var k=el.getAttribute('data-i18n');if(translations[currentLang][k]!==undefined)el.textContent=translations[currentLang][k];});
      document.querySelectorAll('[data-placeholder-i18n]').forEach(function(el){var k=el.getAttribute('data-placeholder-i18n');if(translations[currentLang][k]!==undefined)el.placeholder=translations[currentLang][k];});
    }

    function toggleLang(){
      currentLang=currentLang==="en"?"ar":"en";var h=document.documentElement;
      if(currentLang==="ar"){h.setAttribute("dir","rtl");h.setAttribute("lang","ar");document.getElementById('langBtn').textContent="English";}
      else{h.setAttribute("dir","ltr");h.setAttribute("lang","en");document.getElementById('langBtn').textContent="Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©";}
      applyTranslations();renderSettings();
      if(document.getElementById('admin-dashboard').classList.contains('active'))loadDashboard();
      else if(document.getElementById('admin-applications').classList.contains('active'))loadApplications(currentFilter);
    }

    var allApps=[];var currentFilter="All";var localSettings=[];

    function showAdminSection(s){
      document.querySelectorAll('.section').forEach(function(el){el.classList.remove('active');});
      document.querySelectorAll('.nav-tab').forEach(function(el){el.classList.remove('active');});
      document.getElementById('admin-'+s).classList.add('active');
      var tabs={'dashboard':0,'applications':1,'settings':2};
      document.querySelectorAll('.nav-tab')[tabs[s]].classList.add('active');
      if(s==='dashboard')loadDashboard();if(s==='applications')loadApplications(currentFilter);if(s==='settings')loadSettings();
      window.scrollTo(0,0);
    }

    function loadDashboard(){
      google.script.run.withSuccessHandler(function(st){
        document.getElementById('stat-total').textContent=st.total;
        document.getElementById('stat-pending').textContent=st.pending;
        document.getElementById('stat-review').textContent=st.underReview;
        document.getElementById('stat-approved').textContent=st.approved;
        document.getElementById('stat-rejected').textContent=st.rejected;
      }).withFailureHandler(function(e){console.error(e);}).getDashboardStats();

      google.script.run.withSuccessHandler(function(apps){
        allApps=apps||[];renderAppCards(allApps.slice(0,5),'recentApps');
      }).withFailureHandler(function(e){
        document.getElementById('recentApps').innerHTML='<div class="empty-state"><p>âš ï¸ '+e.message+'</p></div>';
      }).getApplications("All");
    }

    function loadApplications(filter){
      document.getElementById('appsList').innerHTML='<div class="loading-state">'+t('loadingApps')+'</div>';
      google.script.run.withSuccessHandler(function(apps){
        allApps=apps||[];renderAppCards(allApps,'appsList');
      }).withFailureHandler(function(e){
        document.getElementById('appsList').innerHTML='<div class="empty-state"><p>âš ï¸ '+e.message+'</p></div>';
      }).getApplications(filter);
    }

    function renderAppCards(apps,cid){
      var c=document.getElementById(cid);
      if(!apps||apps.length===0){c.innerHTML='<div class="empty-state"><div class="empty-icon">ğŸ“­</div><p>'+t('noApps')+'</p></div>';return;}
      var h='';
      for(var i=0;i<apps.length;i++){var a=apps[i];var sc='status-'+(a.status||'').replace(/\s+/g,'-');
        h+='<div class="app-card" onclick="openDetailByIndex('+i+')"><div class="app-card-header"><div><div class="app-card-name">'+esc(a.firstName)+' '+esc(a.surname)+'</div><div class="app-card-id">'+esc(a.applicationId)+'</div></div><span class="status-badge '+sc+'">'+esc(a.status)+'</span></div><div class="app-card-meta"><span>ğŸŒ '+esc(a.nationality||'N/A')+'</span><span>âœˆï¸ '+esc(a.purposeOfTravel||'N/A')+'</span><span>ğŸ“… '+esc(a.submissionDate||'N/A')+'</span></div></div>';
      }
      c.innerHTML=h;
    }

    function esc(t){if(!t)return'';var d=document.createElement('div');d.textContent=t;return d.innerHTML;}

    function applyFilter(f,btn){
      currentFilter=f;document.querySelectorAll('.filter-btn').forEach(function(b){b.classList.remove('active');});
      btn.classList.add('active');loadApplications(f);
    }




  // ============ Landing Page Settings ============

  function loadLandingSettings() {
    google.script.run
      .withSuccessHandler(function(s) {
        if (!s) return;
        var fields = ['orgName','tagline','heroTitle','heroSubtitle','heroImageUrl',
                       'logoUrl','adminPassword','announcementText','portalButtonText',
                       'adminButtonText','footerText'];
        fields.forEach(function(f) {
          var el = document.getElementById('set_' + f);
          if (el && s[f] !== undefined) el.value = s[f];
        });
        if (s.primaryColor) {
          document.getElementById('set_primaryColor').value = s.primaryColor;
          document.getElementById('set_primaryColorText').value = s.primaryColor;
        }
        if (s.accentColor) {
          document.getElementById('set_accentColor').value = s.accentColor;
          document.getElementById('set_accentColorText').value = s.accentColor;
        }
        // Sync color pickers with text inputs
        document.getElementById('set_primaryColor').addEventListener('input', function() {
          document.getElementById('set_primaryColorText').value = this.value;
        });
        document.getElementById('set_primaryColorText').addEventListener('input', function() {
          try { document.getElementById('set_primaryColor').value = this.value; } catch(e) {}
        });
        document.getElementById('set_accentColor').addEventListener('input', function() {
          document.getElementById('set_accentColorText').value = this.value;
        });
        document.getElementById('set_accentColorText').addEventListener('input', function() {
          try { document.getElementById('set_accentColor').value = this.value; } catch(e) {}
        });
      })
      .withFailureHandler(function(err) {
        console.error('Failed to load landing settings:', err);
      })
      .getLandingSettings();
  }

  function saveLandingSettings() {
    var s = {};
    var fields = ['orgName','tagline','heroTitle','heroSubtitle','heroImageUrl',
                   'logoUrl','adminPassword','announcementText','portalButtonText',
                   'adminButtonText','footerText'];
    fields.forEach(function(f) {
      var el = document.getElementById('set_' + f);
      if (el) s[f] = el.value.trim();
    });
    s.primaryColor = document.getElementById('set_primaryColor').value;
    s.accentColor = document.getElementById('set_accentColor').value;

    var status = document.getElementById('settingsSaveStatus');
    status.textContent = 'Saving...';
    status.style.color = '#3b82f6';

    google.script.run
      .withSuccessHandler(function(result) {
        if (result && result.success) {
          status.textContent = 'âœ“ Settings saved!';
          status.style.color = '#059669';
          setTimeout(function() { status.textContent = ''; }, 3000);
        } else {
          status.textContent = 'âœ— Failed to save';
          status.style.color = '#ef4444';
        }
      })
      .withFailureHandler(function(err) {
        status.textContent = 'âœ— ' + (err.message || 'Error');
        status.style.color = '#ef4444';
      })
      .saveLandingSettings(s);
  }

  // Load landing settings when page loads
  loadLandingSettings();

    function filterLocalApps(){
      var term=document.getElementById('searchInput').value.toLowerCase();
      if(!term){renderAppCards(allApps,'appsList');return;}
      var f=allApps.filter(function(a){
        return(a.surname||'').toLowerCase().indexOf(term)>-1||(a.firstName||'').toLowerCase().indexOf(term)>-1||
        (a.applicationId||'').toLowerCase().indexOf(term)>-1||(a.passportNumber||'').toLowerCase().indexOf(term)>-1||
        (a.email||'').toLowerCase().indexOf(term)>-1;
      });
      renderAppCards(f,'appsList');
    }

    function openDetailByIndex(idx){var app=allApps[idx];if(app)openDetail(app);}
    
    
    
    
        function openDetail(app){
      document.getElementById('detailTitle').textContent=(app.firstName||'')+' '+(app.surname||'');
      var sc='status-'+(app.status||'').replace(/\s+/g,'-');
      var h='';

      // Status card
      h+='<div class="detail-card" style="text-align:center;">';
      h+='<span class="status-badge '+sc+'" style="font-size:14px;padding:8px 20px;">'+esc(app.status)+'</span>';
      h+='<div style="margin-top:8px;font-size:13px;color:var(--gray-500);">'+t('lblAppId')+': '+esc(app.applicationId)+'</div>';
      h+='<div style="font-size:13px;color:var(--gray-500);">'+t('lblSubmitted')+': '+esc(app.submissionDate)+'</div>';
      h+='</div>';

      // Personal Information
      h+='<div class="detail-card"><h3>'+t('secPersonal')+'</h3>';
      h+=dr(t('lblSurname'),app.surname);
      h+=dr(t('lblFirstName'),app.firstName);
      h+=dr(t('lblDob'),app.dateOfBirth);
      h+=dr(t('lblPob'),app.placeOfBirth);
      h+=dr(t('lblNationality'),app.nationality);
      h+=dr(t('lblGender'),app.gender);
      h+=dr(t('lblMarital'),app.maritalStatus);
      h+='</div>';

      // Passport Details
      h+='<div class="detail-card"><h3>'+t('secPassport')+'</h3>';
      h+=dr(t('lblPassportNum'),app.passportNumber);
      h+=dr(t('lblIssuing'),app.issuingCountry);
      h+=dr(t('lblIssueDate'),app.dateOfIssue);
      h+=dr(t('lblExpDate'),app.expirationDate);
      h+='</div>';

      // Contact Information
      h+='<div class="detail-card"><h3>'+t('secContact')+'</h3>';
      h+=dr(t('lblAddress'),app.homeAddress);
      h+=dr(t('lblEmail'),app.email);
      h+=dr(t('lblPhone'),app.telephone);
      h+='</div>';

      // Purpose & Itinerary
      h+='<div class="detail-card"><h3>'+t('secTravel')+'</h3>';
      h+=dr(t('lblPurpose'),app.purposeOfTravel);
      h+=dr(t('lblArrival'),app.arrivalDate);
      h+=dr(t('lblDeparture'),app.departureDate);
      h+=dr(t('lblDestination'),app.destination);
      h+='</div>';

      // Family / Reference
      h+='<div class="detail-card"><h3>'+t('secFamily')+'</h3>';
      h+=dr(t('lblParent'),app.parentSpouseName);
      h+=dr(t('lblSponsor'),app.sponsorContact);
      h+=dr(t('lblHotel'),app.hotelInfo);
      h+='</div>';

      // Photograph - supports both new Drive URLs and legacy base64
      if(app.photoThumb){
        h+='<div class="detail-card"><h3>'+t('secPhoto')+'</h3>';
        h+='<div class="photo-preview">';
        if(app.photoView){
          h+='<a href="'+app.photoView+'" target="_blank" style="text-decoration:none;">';
          h+='<img src="'+app.photoThumb+'" style="cursor:pointer;">';
          h+='</a>';
          h+='<div style="font-size:12px;color:var(--gray-500);margin-top:8px;">'+
            (currentLang==='ar'?'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù…Ù„':'Tap photo to view full size')+'</div>';
        }else{
          h+='<img src="'+app.photoThumb+'">';
        }
        h+='</div></div>';
      }else if(app.photoData){
        // Fallback for any old base64 data still in sheet
        h+='<div class="detail-card"><h3>'+t('secPhoto')+'</h3>';
        h+='<div class="photo-preview"><img src="'+app.photoData+'"></div>';
        h+='</div>';
      }

      // Actions
      var sid=esc(app.applicationId);
      h+='<div class="action-card"><h3>'+t('secActions')+'</h3>';
      h+='<select id="newStatus">';
      h+='<option value="Pending"'+(app.status==="Pending"?" selected":"")+'>'+t('optPending')+'</option>';
      h+='<option value="Under Review"'+(app.status==="Under Review"?" selected":"")+'>'+t('optReview')+'</option>';
      h+='<option value="Approved"'+(app.status==="Approved"?" selected":"")+'>'+t('optApproved')+'</option>';
      h+='<option value="Rejected"'+(app.status==="Rejected"?" selected":"")+'>'+t('optRejected')+'</option>';
      h+='</select>';
      h+='<textarea id="adminNotes" rows="3" placeholder="'+t('notesPlaceholder')+'">'+esc(app.adminNotes||'')+'</textarea>';
      h+='<div id="actionAlert"></div>';
      h+='<button class="btn btn-primary" id="updateBtn" onclick="updateStatus(\''+sid+'\')">'+t('btnUpdate')+'</button>';
      h+='<button class="btn btn-delete" onclick="deleteApp(\''+sid+'\')">'+t('btnDelete')+'</button>';
      h+='</div>';

      document.getElementById('detailBody').innerHTML=h;
      document.getElementById('detailOverlay').classList.add('show');
      document.getElementById('detailOverlay').scrollTop=0;
    }
    
    function dr(l,v){return'<div class="detail-row"><span class="detail-label">'+l+'</span><span class="detail-value">'+esc(v||'N/A')+'</span></div>';}

    function closeDetail(){document.getElementById('detailOverlay').classList.remove('show');}

    function updateStatus(appId){
      var status=document.getElementById('newStatus').value;
      var notes=document.getElementById('adminNotes').value;
      var btn=document.getElementById('updateBtn');
      btn.disabled=true;btn.innerHTML='<span class="spinner"></span> '+t('btnUpdating');

      google.script.run.withSuccessHandler(function(r){
        btn.disabled=false;btn.innerHTML=t('btnUpdate');
        if(r.success){
          document.getElementById('actionAlert').innerHTML='<div class="alert alert-success">'+t('alertUpdated')+'</div>';
          setTimeout(function(){document.getElementById('actionAlert').innerHTML='';},3000);
          loadDashboard();loadApplications(currentFilter);
        }else document.getElementById('actionAlert').innerHTML='<div class="alert alert-error">Error: '+r.error+'</div>';
      }).withFailureHandler(function(e){
        btn.disabled=false;btn.innerHTML=t('btnUpdate');
        document.getElementById('actionAlert').innerHTML='<div class="alert alert-error">Error: '+e.message+'</div>';
      }).updateApplicationStatus(appId,status,notes);
    }

    function deleteApp(appId){
      if(!confirm(t('alertConfirmDelete')))return;
      google.script.run.withSuccessHandler(function(r){
        if(r.success){closeDetail();loadDashboard();loadApplications(currentFilter);}
        else alert('Error: '+r.error);
      }).withFailureHandler(function(e){alert('Error: '+e.message);}).deleteApplication(appId);
    }

    /* ============ SETTINGS ============ */
    function loadSettings(){
      document.getElementById('settingsContainer').innerHTML='<div class="loading-state">'+t('loading')+'</div>';
      google.script.run.withSuccessHandler(function(s){
        localSettings=s||[];renderSettings();
      }).withFailureHandler(function(e){
        document.getElementById('settingsContainer').innerHTML='<div class="empty-state"><p>âš ï¸ '+e.message+'</p></div>';
      }).getFieldSettings();
    }

    function renderSettings(){
      var c=document.getElementById('settingsContainer');
      if(!localSettings||localSettings.length===0){c.innerHTML='<div class="empty-state"><p>'+t('loading')+'</p></div>';return;}

      var groups={};var go=['personal','passport','contact','travel','family'];

      for(var i=0;i<localSettings.length;i++){
        var s=localSettings[i];var g=FIELD_TO_GROUP[s.id]||'family';
        if(!groups[g])groups[g]=[];groups[g].push(s);
      }

      var h='';
      for(var gi=0;gi<go.length;gi++){
        var gk=go[gi];var fields=groups[gk];if(!fields||fields.length===0)continue;
        var gl=(FIELD_GROUPS[currentLang]&&FIELD_GROUPS[currentLang][gk])||FIELD_GROUPS.en[gk];
        h+='<div class="settings-card"><div class="settings-card-header">'+gl+'</div>';
        for(var fi=0;fi<fields.length;fi++){
          var f=fields[fi];
          var fl=(FIELD_LABELS[currentLang]&&FIELD_LABELS[currentLang][f.id])||FIELD_LABELS.en[f.id]||f.id;
          var vc=f.visible?'toggle-switch on':'toggle-switch';
          var rc=f.required?'toggle-switch on-green':'toggle-switch';
          var ro=f.visible?'1':'0.4';
          h+='<div class="field-row"><div class="field-name">'+esc(fl)+'</div><div class="toggle-group">';
          h+='<div class="toggle-item"><span>'+t('toggleVisible')+'</span><div class="'+vc+'" data-field="'+f.id+'" data-type="visible" onclick="toggleSetting(this)"></div></div>';
          h+='<div class="toggle-item" style="opacity:'+ro+'"><span>'+t('toggleRequired')+'</span><div class="'+rc+'" data-field="'+f.id+'" data-type="required" onclick="toggleSetting(this)"></div></div>';
          h+='</div></div>';
        }
        h+='</div>';
      }
      c.innerHTML=h;
    }

    function toggleSetting(el){
      var fid=el.getAttribute('data-field');var type=el.getAttribute('data-type');
      for(var i=0;i<localSettings.length;i++){
        if(localSettings[i].id===fid){
          if(type==='visible'){localSettings[i].visible=!localSettings[i].visible;if(!localSettings[i].visible)localSettings[i].required=false;}
          else if(type==='required'){if(!localSettings[i].visible)return;localSettings[i].required=!localSettings[i].required;}
          break;
        }
      }
      renderSettings();
    }

    function saveSettings(){
      var btn=document.getElementById('saveSettingsBtn');btn.disabled=true;
      btn.innerHTML='<span class="spinner"></span> '+t('settingsSaving');
      var ad=document.getElementById('settingsAlert');ad.innerHTML='';

      google.script.run.withSuccessHandler(function(r){
        btn.disabled=false;btn.innerHTML='<span data-i18n="btnSaveSettings">'+t('btnSaveSettings')+'</span>';
        if(r.success)ad.innerHTML='<div class="alert alert-success">'+t('settingsSaved')+'</div>';
        else ad.innerHTML='<div class="alert alert-error">'+t('settingsError')+r.error+'</div>';
        setTimeout(function(){ad.innerHTML='';},5000);
      }).withFailureHandler(function(e){
        btn.disabled=false;btn.innerHTML='<span data-i18n="btnSaveSettings">'+t('btnSaveSettings')+'</span>';
        ad.innerHTML='<div class="alert alert-error">'+t('settingsError')+e.message+'</div>';
      }).saveFieldSettings(localSettings);
    }

    loadDashboard();
    
    
      // ============ Back to Landing ============

  function goToLanding() {
    document.body.innerHTML = '<div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#0f172a;color:#fff;font-size:16px;">Returning home...</div>';
    google.script.run
      .withSuccessHandler(function(html) {
        document.open();
        document.write(html);
        document.close();
      })
      .withFailureHandler(function() {
        window.location.reload();
      })
      .getPageContent('landing');
  }

  // Handle mobile back button
  history.pushState(null, '', location.href);
  window.addEventListener('popstate', function(e) {
    history.pushState(null, '', location.href);
    goToLanding();
  });
    
    
    
  </script>
</body>
</html>

